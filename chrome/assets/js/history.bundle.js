import{r as i,j as e,c as x,I as C,b as R,u as T,B as L,L as U,k as W,f as H,m as D,R as O,l as I,n as P,o as q}from"./Loader-kohSn8j6.chunk.js";import{M as B,K as w,F as M}from"./background.bundle.js";import{H as F}from"./Header-DpLcczhQ.chunk.js";import{Q as K,C as z}from"./index-CQa3SWQ3.chunk.js";var f=(t=>(t.HYDRATE_SHORTENED_LINKS="hydrate-shortened-links",t.SET_CURRENT_SELECTED="set-current-selected",t))(f||{});const Q={items:[],total:0,selected:null},b=i.createContext(void 0),N=i.createContext(void 0),V=(t,r)=>{switch(r.type){case"hydrate-shortened-links":return{...t,...r.payload};case"set-current-selected":{const a=t.items.filter(l=>l.id===r.payload)[0]||null;return{...t,selected:a}}default:return t}};function A(){const t=i.useContext(b);if(t===void 0)throw new Error("useShortenedLinksContextState must be used within a ShortenedLinksProvider");return t}function Y(){const t=i.useContext(N);if(t===void 0)throw new Error("useShortenedLinksContextDispatch must be used within a ShortenedLinksProvider");return t}function g(){return[A(),Y()]}function G({children:t}){const[r,a]=i.useReducer(V,Q);return e.jsx(e.Fragment,{children:e.jsx(b.Provider,{value:r,children:e.jsx(N.Provider,{value:a,children:t})})})}const $="_modalOverlay_mx1fl_1",X="_modalContent_mx1fl_15",J="_qrCodeWrapper_mx1fl_23",Z="_buttonWrapper_mx1fl_31",ee="_closeButton_mx1fl_37",_={modalOverlay:$,modalContent:X,qrCodeWrapper:J,buttonWrapper:Z,closeButton:ee};function te({link:t,setModalView:r}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:_.modalOverlay,onClick:()=>r(!1),onKeyDown:a=>{a.key==="Escape"&&r(!1)},role:"button",tabIndex:0,children:e.jsxs("div",{className:_.modalContent,onClick:a=>a.stopPropagation(),onKeyDown:a=>a.stopPropagation(),role:"button",tabIndex:0,children:[e.jsx("div",{className:_.qrCodeWrapper,children:e.jsx(K,{size:196,value:t})}),e.jsx("div",{className:_.buttonWrapper,children:e.jsx("button",{onClick:()=>r(!1),className:_.closeButton,type:"button",children:"Close"})})]})})})}const se="_tableContainer_1yvnw_1",oe="_tableWrapper_1yvnw_11",ne="_tableHeader_1yvnw_20",re="_tableTitle_1yvnw_27",ae="_table_1yvnw_1",ie="_thead_1yvnw_45",le="_theadRow_1yvnw_51",ce="_th_1yvnw_45",de="_thOriginal_1yvnw_72",he="_thShort_1yvnw_76",pe="_tbody_1yvnw_80",_e="_tr_1yvnw_86",ue="_td_1yvnw_100",ye="_tdOriginal_1yvnw_107",xe="_tdShort_1yvnw_128",me="_link_1yvnw_149",fe="_copiedNotification_1yvnw_161",ve="_shortUrlWrapper_1yvnw_173",Se="_actionsWrapper_1yvnw_178",Ce="_actionIcon_1yvnw_185",we="_emptyRow_1yvnw_210",s={tableContainer:se,tableWrapper:oe,tableHeader:ne,tableTitle:re,table:ae,thead:ie,theadRow:le,th:ce,thOriginal:de,thShort:he,tbody:pe,tr:_e,td:ue,tdOriginal:ye,tdShort:xe,link:me,copiedNotification:fe,shortUrlWrapper:ve,actionsWrapper:Se,actionIcon:Ce,emptyRow:we};function je(){const[t,r]=g(),[a,l]=i.useState(!1),[c,d]=i.useState(!1);i.useEffect(()=>{let o=null;return o=setTimeout(()=>{d(!1)},1300),()=>{o&&clearTimeout(o)}},[c]);function v(o){r({type:f.SET_CURRENT_SELECTED,payload:o}),d(!0)}function S(o){r({type:f.SET_CURRENT_SELECTED,payload:o}),l(!0)}return e.jsx(e.Fragment,{children:e.jsx("div",{className:s.tableContainer,children:e.jsxs("div",{className:s.tableWrapper,children:[e.jsx("div",{className:s.tableHeader,children:e.jsxs("h2",{className:s.tableTitle,children:["Recent shortened links. (last ",B," results)"]})}),e.jsxs("table",{className:s.table,children:[e.jsx("thead",{className:s.thead,children:e.jsxs("tr",{className:s.theadRow,children:[e.jsx("th",{className:x(s.th,s.thOriginal),children:"Original URL"}),e.jsx("th",{className:x(s.th,s.thShort),children:"Short URL"})]})}),e.jsx("tbody",{className:s.tbody,children:t.total!==0?t.items.map(o=>{var n,h,p;return e.jsxs("tr",{className:s.tr,children:[e.jsx("td",{className:x(s.td,s.tdOriginal),children:e.jsx("a",{className:s.link,href:o.target,target:"_blank",rel:"noopener noreferrer nofollow",children:o.target})}),e.jsxs("td",{className:x(s.td,s.tdShort),children:[c&&((n=t.selected)==null?void 0:n.id)===o.id&&e.jsx("div",{className:s.copiedNotification,children:"Copied to clipboard!"}),e.jsx("div",{className:s.shortUrlWrapper,children:e.jsx("a",{className:s.link,href:o.link,target:"_blank",rel:"noopener noreferrer nofollow",children:o.link})})]}),e.jsxs("td",{className:s.td,children:[e.jsxs("div",{className:s.actionsWrapper,children:[c&&((h=t.selected)==null?void 0:h.id)===o.id?e.jsx(C,{name:"tick",className:s.actionIcon}):e.jsx(z,{text:o.link,onCopy:()=>v(o.id),children:e.jsx(C,{name:"copy",className:s.actionIcon})}),e.jsx(C,{onClick:()=>S(o.id),className:s.actionIcon,name:"qrcode"})]}),a&&((p=t.selected)==null?void 0:p.id)===o.id&&e.jsx(te,{link:o.link,setModalView:l})]})]},o.id)}):e.jsx("tr",{children:e.jsx("td",{className:s.emptyRow,children:"No URLs History"})})})]})]})})})}const be="_historyPage_zwx24_1",Ne="_historyContent_zwx24_7",ge="_errorMessage_zwx24_16",ke="_loaderContainer_zwx24_28",m={historyPage:be,historyContent:Ne,errorMessage:ge,loaderContainer:ke};function Ee(){const[,t]=g(),[,r]=R(),[a,l]=T(),[c,d]=i.useState({error:null,message:""}),[v,S]=i.useState(w.hostUrl);return i.useEffect(()=>{async function o(){var j;const{settings:n={}}=await W(),h=(n==null?void 0:n.advanced)||!1,p=h&&(n==null?void 0:n.host)&&H(n.host)&&{hostDomain:n.host.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0]||"",hostUrl:n.host.endsWith("/")?n.host.slice(0,-1):n.host}||w,u={apikey:((j=n==null?void 0:n.apikey)==null?void 0:j.trim())||"",history:(n==null?void 0:n.history)||!1,advanced:p.hostUrl.trim()!==w.hostUrl&&h,host:p};if(S(u.host.hostUrl),u.history){const E={apikey:u.apikey,hostUrl:u.host.hostUrl},y=await D.send(M,E);y.error?d({error:!0,message:y.message}):(d({error:!1,message:"Fetch successful"}),t({type:f.HYDRATE_SHORTENED_LINKS,payload:{items:y.data.data,total:y.data.total}}))}else d({error:!0,message:"History page disabled. Please enable it from settings."});l({type:O.SET_LOADING,payload:!1})}o()},[r,l,t]),e.jsx(L,{children:e.jsx("div",{id:"history",className:m.historyPage,children:e.jsxs("div",{className:m.historyContent,children:[e.jsx(F,{subtitle:"Recent Links",hostUrl:v}),a.loading?e.jsx("div",{className:m.loaderContainer,children:e.jsx(U,{})}):c.error?e.jsx("h2",{className:m.errorMessage,children:c.message}):e.jsx(je,{})]})})})}const k=document.getElementById("history-root");if(!k)throw new Error("Could not find history-root container");const Re=I.createRoot(k);Re.render(e.jsx(i.StrictMode,{children:e.jsx(P,{children:e.jsx(q,{children:e.jsx(G,{children:e.jsx(Ee,{})})})})}));
