import{r as a,j as e,c as u,I as v,b as E,u as R,B as T,L,k as U,f as W,m as H,R as D,l as O,n as I,o as P}from"./Loader-COv0jRMw.chunk.js";import{M as q,K as S,F as B}from"./background.bundle.js";import{H as M}from"./Header-CVO8RHl_.chunk.js";import{Q as F,C as K}from"./index-DiGfVt06.chunk.js";var x=(t=>(t.HYDRATE_SHORTENED_LINKS="hydrate-shortened-links",t.SET_CURRENT_SELECTED="set-current-selected",t))(x||{});const z={items:[],total:0,selected:null},j=a.createContext(void 0),b=a.createContext(void 0),Q=(t,n)=>{switch(n.type){case"hydrate-shortened-links":return{...t,...n.payload};case"set-current-selected":{const r=t.items.filter(l=>l.id===n.payload)[0]||null;return{...t,selected:r}}default:return t}};function V(){const t=a.useContext(j);if(t===void 0)throw new Error("useShortenedLinksContextState must be used within a ShortenedLinksProvider");return t}function A(){const t=a.useContext(b);if(t===void 0)throw new Error("useShortenedLinksContextDispatch must be used within a ShortenedLinksProvider");return t}function g(){return[V(),A()]}function Y({children:t}){const[n,r]=a.useReducer(Q,z);return e.jsx(e.Fragment,{children:e.jsx(j.Provider,{value:n,children:e.jsx(b.Provider,{value:r,children:t})})})}const G="_modalOverlay_mx1fl_1",$="_modalContent_mx1fl_15",X="_qrCodeWrapper_mx1fl_23",J="_buttonWrapper_mx1fl_31",Z="_closeButton_mx1fl_37",h={modalOverlay:G,modalContent:$,qrCodeWrapper:X,buttonWrapper:J,closeButton:Z};function ee({link:t,setModalView:n}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:h.modalOverlay,onClick:()=>n(!1),onKeyDown:r=>{r.key==="Escape"&&n(!1)},role:"button",tabIndex:0,children:e.jsxs("div",{className:h.modalContent,onClick:r=>r.stopPropagation(),onKeyDown:r=>r.stopPropagation(),role:"button",tabIndex:0,children:[e.jsx("div",{className:h.qrCodeWrapper,children:e.jsx(F,{size:196,value:t})}),e.jsx("div",{className:h.buttonWrapper,children:e.jsx("button",{onClick:()=>n(!1),className:h.closeButton,type:"button",children:"Close"})})]})})})}const te="_tableContainer_1yvnw_1",se="_tableWrapper_1yvnw_11",oe="_tableHeader_1yvnw_20",ne="_tableTitle_1yvnw_27",re="_table_1yvnw_1",ae="_thead_1yvnw_45",ie="_theadRow_1yvnw_51",le="_th_1yvnw_45",ce="_thOriginal_1yvnw_72",de="_thShort_1yvnw_76",he="_tbody_1yvnw_80",pe="_tr_1yvnw_86",_e="_td_1yvnw_100",ue="_tdOriginal_1yvnw_107",ye="_tdShort_1yvnw_128",xe="_link_1yvnw_149",me="_copiedNotification_1yvnw_161",fe="_shortUrlWrapper_1yvnw_173",ve="_actionsWrapper_1yvnw_178",Se="_actionIcon_1yvnw_185",Ce="_emptyRow_1yvnw_210",s={tableContainer:te,tableWrapper:se,tableHeader:oe,tableTitle:ne,table:re,thead:ae,theadRow:ie,th:le,thOriginal:ce,thShort:de,tbody:he,tr:pe,td:_e,tdOriginal:ue,tdShort:ye,link:xe,copiedNotification:me,shortUrlWrapper:fe,actionsWrapper:ve,actionIcon:Se,emptyRow:Ce};function we(){const[t,n]=g(),[r,l]=a.useState(!1),[c,d]=a.useState(!1);a.useEffect(()=>{let o=null;return o=setTimeout(()=>{d(!1)},1300),()=>{o&&clearTimeout(o)}},[c]);function m(o){n({type:x.SET_CURRENT_SELECTED,payload:o}),d(!0)}function f(o){n({type:x.SET_CURRENT_SELECTED,payload:o}),l(!0)}return e.jsx(e.Fragment,{children:e.jsx("div",{className:s.tableContainer,children:e.jsxs("div",{className:s.tableWrapper,children:[e.jsx("div",{className:s.tableHeader,children:e.jsxs("h2",{className:s.tableTitle,children:["Recent shortened links. (last ",q," results)"]})}),e.jsxs("table",{className:s.table,children:[e.jsx("thead",{className:s.thead,children:e.jsxs("tr",{className:s.theadRow,children:[e.jsx("th",{className:u(s.th,s.thOriginal),children:"Original URL"}),e.jsx("th",{className:u(s.th,s.thShort),children:"Short URL"})]})}),e.jsx("tbody",{className:s.tbody,children:t.total!==0?t.items.map(o=>e.jsxs("tr",{className:s.tr,children:[e.jsx("td",{className:u(s.td,s.tdOriginal),children:e.jsx("a",{className:s.link,href:o.target,target:"_blank",rel:"noopener noreferrer nofollow",children:o.target})}),e.jsxs("td",{className:u(s.td,s.tdShort),children:[c&&t.selected?.id===o.id&&e.jsx("div",{className:s.copiedNotification,children:"Copied to clipboard!"}),e.jsx("div",{className:s.shortUrlWrapper,children:e.jsx("a",{className:s.link,href:o.link,target:"_blank",rel:"noopener noreferrer nofollow",children:o.link})})]}),e.jsxs("td",{className:s.td,children:[e.jsxs("div",{className:s.actionsWrapper,children:[c&&t.selected?.id===o.id?e.jsx(v,{name:"tick",className:s.actionIcon}):e.jsx(K,{text:o.link,onCopy:()=>m(o.id),children:e.jsx(v,{name:"copy",className:s.actionIcon})}),e.jsx(v,{onClick:()=>f(o.id),className:s.actionIcon,name:"qrcode"})]}),r&&t.selected?.id===o.id&&e.jsx(ee,{link:o.link,setModalView:l})]})]},o.id)):e.jsx("tr",{children:e.jsx("td",{className:s.emptyRow,children:"No URLs History"})})})]})]})})})}const je="_historyPage_zwx24_1",be="_historyContent_zwx24_7",ge="_errorMessage_zwx24_16",Ne="_loaderContainer_zwx24_28",y={historyPage:je,historyContent:be,errorMessage:ge,loaderContainer:Ne};function ke(){const[,t]=g(),[,n]=E(),[r,l]=R(),[c,d]=a.useState({error:null,message:""}),[m,f]=a.useState(S.hostUrl);return a.useEffect(()=>{async function o(){const{settings:i={}}=await U(),C=i?.advanced||!1,w=C&&i?.host&&W(i.host)&&{hostDomain:i.host.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0]||"",hostUrl:i.host.endsWith("/")?i.host.slice(0,-1):i.host}||S,p={apikey:i?.apikey?.trim()||"",history:i?.history||!1,advanced:w.hostUrl.trim()!==S.hostUrl&&C,host:w};if(f(p.host.hostUrl),p.history){const k={apikey:p.apikey,hostUrl:p.host.hostUrl},_=await H.send(B,k);_.error?d({error:!0,message:_.message}):(d({error:!1,message:"Fetch successful"}),t({type:x.HYDRATE_SHORTENED_LINKS,payload:{items:_.data.data,total:_.data.total}}))}else d({error:!0,message:"History page disabled. Please enable it from settings."});l({type:D.SET_LOADING,payload:!1})}o()},[n,l,t]),e.jsx(T,{children:e.jsx("div",{id:"history",className:y.historyPage,children:e.jsxs("div",{className:y.historyContent,children:[e.jsx(M,{subtitle:"Recent Links",hostUrl:m}),r.loading?e.jsx("div",{className:y.loaderContainer,children:e.jsx(L,{})}):c.error?e.jsx("h2",{className:y.errorMessage,children:c.message}):e.jsx(we,{})]})})})}const N=document.getElementById("history-root");if(!N)throw new Error("Could not find history-root container");const Ee=O.createRoot(N);Ee.render(e.jsx(a.StrictMode,{children:e.jsx(I,{children:e.jsx(P,{children:e.jsx(Y,{children:e.jsx(ke,{})})})})}));
